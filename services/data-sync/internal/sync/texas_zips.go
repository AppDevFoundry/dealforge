package sync

import (
	"bufio"
	"os"
	"strings"
)

// MajorTexasZIPs contains ZIP codes for major Texas metros.
// Used for testing and when full ZIP file is not available.
var MajorTexasZIPs = []string{
	// Houston Metro
	"77001", "77002", "77003", "77004", "77005", "77006", "77007", "77008", "77009", "77010",
	"77019", "77020", "77021", "77022", "77023", "77024", "77025", "77026", "77027", "77028",
	"77030", "77031", "77032", "77033", "77034", "77035", "77036", "77037", "77038", "77039",
	"77040", "77041", "77042", "77043", "77044", "77045", "77046", "77047", "77048", "77049",
	"77050", "77051", "77053", "77054", "77055", "77056", "77057", "77058", "77059", "77060",
	// Dallas Metro
	"75001", "75002", "75006", "75007", "75009", "75010", "75011", "75013", "75014", "75015",
	"75019", "75020", "75022", "75023", "75024", "75025", "75028", "75029", "75030", "75032",
	"75034", "75035", "75038", "75039", "75040", "75041", "75042", "75043", "75044", "75046",
	"75048", "75050", "75051", "75052", "75054", "75056", "75057", "75060", "75061", "75062",
	"75063", "75065", "75067", "75068", "75069", "75070", "75071", "75074", "75075", "75077",
	// San Antonio Metro
	"78201", "78202", "78203", "78204", "78205", "78207", "78208", "78209", "78210", "78211",
	"78212", "78213", "78214", "78215", "78216", "78217", "78218", "78219", "78220", "78221",
	"78222", "78223", "78224", "78225", "78226", "78227", "78228", "78229", "78230", "78231",
	"78232", "78233", "78234", "78235", "78236", "78237", "78238", "78239", "78240", "78242",
	"78243", "78244", "78245", "78247", "78248", "78249", "78250", "78251", "78252", "78253",
	// Austin Metro
	"78701", "78702", "78703", "78704", "78705", "78712", "78717", "78719", "78721", "78722",
	"78723", "78724", "78725", "78726", "78727", "78728", "78729", "78730", "78731", "78732",
	"78733", "78734", "78735", "78736", "78737", "78738", "78739", "78741", "78742", "78744",
	"78745", "78746", "78747", "78748", "78749", "78750", "78751", "78752", "78753", "78754",
	"78756", "78757", "78758", "78759", "78660", "78664", "78681",
	// Fort Worth Metro
	"76101", "76102", "76103", "76104", "76105", "76106", "76107", "76108", "76109", "76110",
	"76111", "76112", "76114", "76115", "76116", "76117", "76118", "76119", "76120", "76123",
	"76126", "76127", "76129", "76130", "76131", "76132", "76133", "76134", "76135", "76137",
	"76140", "76148", "76155", "76177", "76179", "76180", "76182",
	// El Paso Metro
	"79901", "79902", "79903", "79904", "79905", "79906", "79907", "79908", "79910", "79911",
	"79912", "79915", "79922", "79924", "79925", "79927", "79928", "79930", "79932", "79934",
	"79935", "79936", "79938",
}

// LoadZIPsFromFile reads ZIP codes from a file (one per line).
func LoadZIPsFromFile(path string) ([]string, error) {
	file, err := os.Open(path)
	if err != nil {
		return nil, err
	}
	defer file.Close()

	var zips []string
	scanner := bufio.NewScanner(file)
	for scanner.Scan() {
		zip := strings.TrimSpace(scanner.Text())
		if zip != "" && len(zip) == 5 {
			zips = append(zips, zip)
		}
	}

	if err := scanner.Err(); err != nil {
		return nil, err
	}

	return zips, nil
}

// ParseZIPList parses a comma-separated list of ZIP codes.
func ParseZIPList(list string) []string {
	if list == "" {
		return nil
	}

	parts := strings.Split(list, ",")
	zips := make([]string, 0, len(parts))
	for _, p := range parts {
		zip := strings.TrimSpace(p)
		if zip != "" && len(zip) == 5 {
			zips = append(zips, zip)
		}
	}
	return zips
}
